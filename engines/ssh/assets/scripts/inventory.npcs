function dropStored(goods, place, path = null, punctual = true)
	drop = inventory.planDropStored(goods, place)
	plan drop
		if not path then path = find.path(place, punctual)
		if tile != place then do
			walk.into path
		while tile != place
			path = find.path(place, punctual)
		loop
		if not punctual then walk.enter
		inventory.effectuate drop
	end plan
end function

function grabStored(goods, place, path = null, punctual = true)
	if not path then path = find.path(place, punctual)
	grab = inventory.planGrabStored(goods, place)
	plan grab
		if tile != place then do
			walk.into path
		while tile != place
			path = find.path(place, punctual)
		loop
		if not punctual then walk.enter
		inventory.effectuate grab
	end plan
end function

function grabFree(good, place, path = null, punctual = true)
	if not path then path = find.path(place, punctual)
	grab = inventory.planGrabFree(good, place)
	plan grab
		if tile != place then do
			walk.into path
		while tile != place
			path = find.path(place, punctual)
		loop
		if not punctual then walk.enter
		inventory.effectuate grab
	end plan
end function

function dropAllFree()
	where = find.freeSpot()
	if not where then return false
	walk.into where
	do
		good = aKey(I.carry.availables)
	while good
		// Move around the tile for preparationTime before dropping
		walk.moveTo find.randomPositionInTile()
		print "dropAllFree: trying to drop", good, "available:", I.carry.availables[good]
		if I.carry.availables[good] > 0 then
			inventory.dropAsFreeGood good
		end if
	loop
end function

function makeRoom()
	do while not haveRoom()
		where = find.freeSpot()
		if not where then return false	// TODO: failure behaviour
		walk.into where
		good = aKey(I.carry.availables)
		if not good then
			debugger I.vehicle
			error "Try to make room but has no good to drop"
		end if
		// Move around the tile for preparationTime before dropping
		walk.moveTo find.randomPositionInTile()
		print "makeRoom: trying to drop", good, "available:", I.carry.availables[good]
		if I.carry.availables[good] > 0 then
			inventory.dropAsFreeGood good
		end if
	loop
end function

return { dropAllFree, makeRoom, dropStored, grabStored, grabFree }


